name: bundleTests
on: [pull_request]

jobs:
  analyze-bundles:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2
      - run: npm install
      - run: npm run analyzeBundles --silent
        id: bundleSizesPRComment

  update_comment_pr:
    name: update PR comment
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: npm install
      - run: npm run deployPRComment
        id: deploy_PRComment
      - run: npm run updatePRComment
    env:
      REPO_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      SURGE_LOGIN: ${{ secrets.SURGE_LOGIN }}
      SURGE_TOKEN: ${{ secrets.SURGE_TOKEN }}
      # message: 'bla bla'
      message: '${{ analyze-bundles.steps.bundleSizesPRComment.outputs.bundleSizes_message }}\n ${{ steps.deploy_PRComment.outputs.deploy_message }}'
