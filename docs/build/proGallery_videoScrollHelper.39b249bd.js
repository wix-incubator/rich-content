(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{962:function(t,i,e){"use strict";e.r(i);var o=e(156),s=e(798),n=e(953),a=e(605),l=e(468),r={SCROLL:"SCROLL",CLICKED:"CLICKED",HOVERED:"HOVERED",ENDED:"ENDED",INIT_SCROLL:"INIT_SCROLL"},d=function(){function t(t){var i=this;this.scrollBase=0,this.videoItems=[],this.currentPlayingIdx=-1,this.lastItemCount=0,this.playing=!1,this.updateGalleryStructure=this.updateGalleryStructure.bind(this),this.initializePlayState=this.initializePlayState.bind(this),this.onScroll=this.onScroll.bind(this),this.handleEvent=this.handleEvent.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.isVisible=this.isVisible.bind(this),this.top=0,this.left=0,this.videoPlay=void 0,this.itemClick=void 0,this.setPlayingVideos=t.setPlayingVideos,this.lastVideoPlayed=-1,this.trigger=Object.assign.apply(Object,Object(o.f)([{}],Object.keys(r).map((function(t){var e;return(e={})[t]=function(e){return i.handleEvent({eventName:t,eventData:e})},e}))))}return t.prototype.updateGalleryStructure=function(t){var i=this,e=t.galleryStructure,n=t.scrollBase,a=t.videoPlay,l=t.videoLoop,r=t.itemClick,d=t.oneRow;this.galleryWidth=s.a.getGalleryDimensions().galleryWidth,this.scrollBase=n,this.videoPlay=a,this.videoLoop=l,this.itemClick=r,this.oneRow=d;var h=this.lastItemCount,p=e.galleryItems.length;(this.lastItemCount=p,h!==p)&&e.galleryItems.slice(h,p).forEach((function(t){("video"===t.type||"image"===t.type&&(t.id.includes("_placeholder")||t.isVideoPlaceholder))&&i.videoItems.push(Object(o.a)(Object(o.a)({},t),{videoPlayRating:t.idx}))}))},t.prototype.handleEvent=function(t){var i=t.eventName,e=t.eventData;switch(i){case r.SCROLL:this.onScroll(e);break;case n.a.events.ITEM_ACTION_TRIGGERED:this.itemClicked(e.idx);break;case n.a.events.HOVER_SET:this.itemHovered(e);break;case n.a.events.VIDEO_ENDED:this.videoEnded(e.idx);break;case n.a.events.VIDEO_PLAYED:this.videoPlayed(e.idx);break;case n.a.events.VIDEO_ERROR:this.videoErrorReported();break;case r.INIT_SCROLL:this.ScrollializePlayState()}},t.prototype.itemHovered=function(t){"hover"===this.videoPlay&&this.IdxExistsInVideoItems(t)&&this.play(t)},t.prototype.itemClicked=function(t){"onClick"===this.videoPlay&&this.IdxExistsInVideoItems(t)&&(this.currentPlayingIdx===t?this.stop():this.play(t))},t.prototype.onScroll=function(t){var i=this,e=t.top,o=t.left;this.top=e||this.top,this.left=o||this.left,-1===this.currentPlayingIdx||this.isCurrentVideoStillVisible({top:this.top,left:this.left})||this.stop(this.videoItems.findIndex((function(t){return t.idx===i.currentPlayingIdx}))),this.autoPlayNextVideoByRating({top:this.top,left:this.left})},t.prototype.videoEnded=function(t){var i=this.videoItems.findIndex((function(i){return i.idx===t}));this.stop(i);var e={top:this.top,left:this.left};this.autoPlayNextVideoByRating(e)},t.prototype.videoPlayed=function(t){this.lastVideoPlayed=t},t.prototype.videoErrorReported=function(){this.stop()},t.prototype.initializePlayState=function(){this.autoPlayNextVideoByRating({top:this.top,left:this.left})},t.prototype.autoPlayNextVideoByRating=function(t){var i=this,e=t.top,o=t.left;if(this.shouldAutoPlay()){var s={idx:-1,rating:1/0},n={idx:-1,rating:1/0};if(this.videoItems.some((function(t){return i.isVisible(t,{top:e,left:o})?(t.videoPlayRating<=n.rating?(s.idx=n.idx,s.rating=n.rating,n.idx=t.idx,n.rating=t.videoPlayRating):t.videoPlayRating<=s.rating&&(s.idx=t.idx,s.rating=t.videoPlayRating),!1):n.idx>=0})),n.idx>=0)if(this.allowedLoop()||n.idx!==this.lastVideoPlayed)this.play(n.idx);else{if(!(s.idx>=0))return;this.play(s.idx)}else this.lastVideoPlayed=-2}},t.prototype.calculateCurrentItemPlacement=function(){var t=this;return this.videoItems.findIndex((function(i){return i.idx===t.currentPlayingIdx}))},t.prototype.play=function(t){this.setPlayingIdx(t),this.playing=!0},t.prototype.stop=function(t){t>=0&&(this.videoItems[t].videoPlayRating+=1337),this.setPlayingIdx(-1),this.playing=!1},t.prototype.onPlayingIdxChange=function(){this.setPlayingVideos(this.currentPlayingIdx)},t.prototype.setPlayingIdx=function(t){this.currentPlayingIdx!==t&&(this.currentPlayingIdx=t,this.onPlayingIdxChange())},t.prototype.isCurrentVideoStillVisible=function(t){var i=t.top,e=t.left,o=this.calculateCurrentItemPlacement();return this.isVisible(this.videoItems[o],{top:i,left:e})},t.prototype.isVisible=function(t,i){var e,o=i.top,s=i.left,n={offsetTop:this.scrollBase||0,scrollY:o,scrollLeft:s},r=(t.offset.top-t.offset.bottom)/2,d=(t.offset.left-t.offset.right)/2,h=Object(l.b)({target:n,scrollBase:this.scrollBase,top:t.offset.top,bottom:t.offset.top+t.style.height,screenHeight:a.a&&a.a.innerHeight,padding:r});return e=!this.oneRow||Object(l.a)({target:n,left:t.offset.left,right:t.offset.left+t.style.width,screenWidth:this.galleryWidth||a.a&&a.a.innerWidth,padding:d}),h&&e},t.prototype.shouldAutoPlay=function(){return"auto"===this.videoPlay},t.prototype.allowedLoop=function(){return!0===this.videoLoop},t.prototype.IdxExistsInVideoItems=function(t){return this.videoItems.some((function(i){return i.idx===t}))},t}();i.default=d}}]);