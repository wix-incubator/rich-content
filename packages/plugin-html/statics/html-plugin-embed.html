<!DOCTYPE html>
<html>

<head>
  <style type="text/css">
    iframe[class|='instagram'],
    blockquote[class|='instagram'] {
      /* fallback script for ios below */
      min-width: 0 !important;
      width: calc(100vw - 2px);
    }

    body {
      margin: 0;
      max-width: calc(100vw);
    }
  </style>
  <script>
    (function fixInstagramWidth() { // This is a fallback for the styles above. Because inline styles can't be overridden in ios.
      var callback = function () {
        try {
          if (document.body.firstChild.className.indexOf('instagram') >= 0) {
            document.body.firstChild.style.minWidth = '0';
            document.body.firstChild.style.width = 'calc(100vw - 2px)';
          }
        } catch (e) {}
      };

      var observer = new MutationObserver(callback);

      observer.observe(document, {
        childList: true,
        subtree: true
      });
    })();

    function initSendHeight(parentId) {
      var oldMaxHeight;
      function sendHeight() {
        var scrollHeight = document.body.scrollHeight;
        if (scrollHeight !== oldMaxHeight) {
          oldMaxHeight = scrollHeight;
          parent.postMessage({type: 'htmlPlugin:maxHeight', id: parentId, height: scrollHeight},'*');
        }
      }

      function multipleDelayedSendHeight() {
        setTimeout(function () {
          sendHeight();
        }, 0);
        setTimeout(function () {
          sendHeight();
        }, 50);
        setTimeout(function () {
          sendHeight();
        }, 200);
      }

      var observer = new MutationObserver(multipleDelayedSendHeight); //this handles loading phase
      observer.observe(document, {
        childList: true,
        subtree: true
      });

      window.onresize = multipleDelayedSendHeight; //this handles width change
    }

    window.addEventListener('message', function (event) {
      if (event.data.type !== 'htmlPlugin:updateContent') {
        return;
      }

      var content = [
        '<!DOCTYPE html>',
        '<html>',
        '<head>' + document.head.innerHTML + '</head>',
        '<body>' + event.data.content + '</body>',
        '</html>',
      ].join('');

      document.open('text/html', 'replace');
      document.write(content);
      document.close();

      initSendHeight(event.data.id)
    });
  </script>
</head>

<body></body>

</html>
